import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutter/material.dart';
import '../../domain/entities/futsal_field.dart';
import '../../domain/entities/time_range.dart';

class FutsalFieldModel extends FutsalField {
  FutsalFieldModel({
    required String id,
    required String name,
    String? groundType,
    required String description,
    required String address,
    required String city,
    GeoPoint? location,
    required double pricePerHour,
    double? discount,
    required String currency,
    Map<String, List<TimeRange>>? schedule,
    String? size,
    String? grassType,
    bool lightsAvailable = false,
    bool parkingAvailable = false,
    bool changingRoomAvailable = false,
    bool washroomAvailable = false,
    required String coverImageUrl,
    List<String> galleryImageUrls = const [],
    required String phoneNumber,
    String? whatsappNumber,
    String? email,
    required String ownerId,
    double rating = 0.0,
    bool isFavorite = false,
    bool autoAcceptBookings = true,
    String? bankDetails,
    String status = 'pending',
    Map<String, dynamic>? pendingUpdates,
  }) : super(
          id: id,
          name: name,
          groundType: groundType,
          description: description,
          address: address,
          city: city,
          location: location,
          pricePerHour: pricePerHour,
          discount: discount,
          currency: currency,
          schedule: schedule,
          size: size,
          grassType: grassType,
          lightsAvailable: lightsAvailable,
          parkingAvailable: parkingAvailable,
          changingRoomAvailable: changingRoomAvailable,
          washroomAvailable: washroomAvailable,
          coverImageUrl: coverImageUrl,
          galleryImageUrls: galleryImageUrls,
          phoneNumber: phoneNumber,
          whatsappNumber: whatsappNumber,
          email: email,
          ownerId: ownerId,
          rating: rating,
          isFavorite: isFavorite,
          autoAcceptBookings: autoAcceptBookings,
          bankDetails: bankDetails,
          status: status,
          pendingUpdates: pendingUpdates,
        );

  factory FutsalFieldModel.fromSnapshot(DocumentSnapshot snapshot) {
    final data = snapshot.data() as Map<String, dynamic>;
    return FutsalFieldModel(
      id: snapshot.id,
      name: data['name'] ?? '',
      groundType: data['groundType'],
      description: data['description'] ?? '',
      address: data['address'] ?? '',
      city: data['city'] ?? '',
      location: data['location'] as GeoPoint?,
      pricePerHour: (data['pricePerHour'] ?? 0).toDouble(),
      discount: (data['discount'])?.toDouble(),
      currency: data['currency'] ?? '',
      schedule: (data['schedule'] as Map<String, dynamic>?)?.map(
        (key, value) => MapEntry(
          key,
          (value as List).map((e) => TimeRange.fromMap(e)).toList(),
        ),
      ),
      size: data['size'],
      grassType: data['grassType'],
      lightsAvailable: data['lightsAvailable'] ?? false,
      parkingAvailable: data['parkingAvailable'] ?? false,
      changingRoomAvailable: data['changingRoomAvailable'] ?? false,
      washroomAvailable: data['washroomAvailable'] ?? false,
      coverImageUrl: data['coverImageUrl'] ?? '',
      galleryImageUrls: List<String>.from(data['galleryImageUrls'] ?? []),
      phoneNumber: data['phoneNumber'] ?? '',
      whatsappNumber: data['whatsappNumber'],
      email: data['email'],
      ownerId: data['ownerId'] ?? '',
      rating: (data['rating'] ?? 0).toDouble(),
      autoAcceptBookings: data['autoAcceptBookings'] ?? true,
      bankDetails: data['bankDetails'],
      status: data['status'] ?? 'pending',
      pendingUpdates: data['pendingUpdates'],
    );
  }

  Map<String, dynamic> toMap() {
    return {
      'name': name,
      'groundType': groundType,
      'description': description,
      'address': address,
      'city': city,
      'location': location,
      'pricePerHour': pricePerHour,
      'discount': discount,
      'currency': currency,
      'schedule': schedule?.map((key, value) => MapEntry(key, value.map((e) => e.toMap()).toList())),
      'size': size,
      'grassType': grassType,
      'lightsAvailable': lightsAvailable,
      'parkingAvailable': parkingAvailable,
      'changingRoomAvailable': changingRoomAvailable,
      'washroomAvailable': washroomAvailable,
      'coverImageUrl': coverImageUrl,
      'galleryImageUrls': galleryImageUrls,
      'phoneNumber': phoneNumber,
      'whatsappNumber': whatsappNumber,
      'email': email,
      'ownerId': ownerId,
      'rating': rating,
      'autoAcceptBookings': autoAcceptBookings,
      'bankDetails': bankDetails,
      'status': status,
      'pendingUpdates': pendingUpdates,
    };
  }

  static FutsalFieldModel fromEntity(FutsalField entity) {
    return FutsalFieldModel(
      id: entity.id,
      name: entity.name,
      groundType: entity.groundType,
      description: entity.description,
      address: entity.address,
      city: entity.city,
      location: entity.location,
      pricePerHour: entity.pricePerHour,
      discount: entity.discount,
      currency: entity.currency,
      schedule: entity.schedule,
      size: entity.size,
      grassType: entity.grassType,
      lightsAvailable: entity.lightsAvailable,
      parkingAvailable: entity.parkingAvailable,
      changingRoomAvailable: entity.changingRoomAvailable,
      washroomAvailable: entity.washroomAvailable,
      coverImageUrl: entity.coverImageUrl,
      galleryImageUrls: entity.galleryImageUrls,
      phoneNumber: entity.phoneNumber,
      whatsappNumber: entity.whatsappNumber,
      email: entity.email,
      ownerId: entity.ownerId,
      rating: entity.rating,
      isFavorite: entity.isFavorite,
      autoAcceptBookings: entity.autoAcceptBookings,
      bankDetails: entity.bankDetails,
      status: entity.status,
      pendingUpdates: entity.pendingUpdates,
    );
  }

  @override
  FutsalField toEntity() {
    return FutsalField(
      id: id,
      name: name,
      groundType: groundType,
      description: description,
      address: address,
      city: city,
      location: location,
      pricePerHour: pricePerHour,
      discount: discount,
      currency: currency,
      schedule: schedule,
      size: size,
      grassType: grassType,
      lightsAvailable: lightsAvailable,
      parkingAvailable: parkingAvailable,
      changingRoomAvailable: changingRoomAvailable,
      washroomAvailable: washroomAvailable,
      coverImageUrl: coverImageUrl,
      galleryImageUrls: galleryImageUrls,
      phoneNumber: phoneNumber,
      whatsappNumber: whatsappNumber,
      email: email,
      ownerId: ownerId,
      rating: rating,
      isFavorite: isFavorite,
      autoAcceptBookings: autoAcceptBookings,
      bankDetails: bankDetails,
      status: status,
      pendingUpdates: pendingUpdates,
    );
  }
}
